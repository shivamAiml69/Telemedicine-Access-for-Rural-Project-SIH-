<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doctor Dashboard — Telemedicine Nabha</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
    body { background:#f4f7f9; color:#333; }

    /* Header & Navigation */
    header {
      background:linear-gradient(135deg, #0b64e7, #074eb4);
      color:white;
      padding:15px 30px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo h1 { font-size:24px; font-weight:600; }
    
    .logo i {
      font-size: 28px;
    }
    
    nav a {
      margin-left:25px;
      text-decoration:none;
      color:white;
      font-weight:500;
      transition:opacity 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    nav a:hover { opacity:0.8; }

    /* Container */
    .container {
      padding:30px 20px;
      max-width:1200px;
      margin:auto;
    }

    /* Welcome card */
    .welcome-card {
      background:white;
      padding:25px;
      border-radius:15px;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
      margin-bottom:30px;
      animation:fadeIn 1s ease;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .doctor-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #0b64e7, #4e54c8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 32px;
    }
    
    .welcome-text h2 { 
      margin-bottom:8px; 
      color: #0b64e7;
    }
    
    .welcome-text p { color:#666; }

    /* Stats Cards */
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .stat-icon.appointments {
      background: rgba(11, 100, 231, 0.1);
      color: #0b64e7;
    }
    
    .stat-icon.completed {
      background: rgba(40, 167, 69, 0.1);
      color: #28a745;
    }
    
    .stat-icon.pending {
      background: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }
    
    .stat-info h3 {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .stat-info p {
      color: #555;
      font-size: 14px;
    }

    /* Appointments Section */
    .appointments-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      overflow: hidden;
      animation: fadeInUp 1s ease;
    }
    
    .section-header {
      padding: 20px 25px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-header h3 {
      font-size: 22px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .filter-options {
      display: flex;
      gap: 10px;
    }
    
    .filter-btn {
      padding: 8px 15px;
      border-radius: 20px;
      border: none;
      background: #e9ecef;
      color: #555;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .filter-btn.active {
      background: #0b64e7;
      color: white;
    }
    
    .filter-btn:hover {
      background: #0b64e7;
      color: white;
    }

    /* Appointments Table */
    .appointments-table {
      width:100%;
      border-collapse:collapse;
    }
    
    .appointments-table th {
      background:#f9fbff;
      padding:15px;
      text-align:left;
      font-weight:600;
      color:#333;
      border-bottom:1px solid #e9ecef;
    }
    
    .appointments-table td {
      padding:15px;
      border-bottom:1px solid #e9ecef;
    }
    
    .appointments-table tr:last-child td {
      border-bottom: none;
    }
    
    .appointments-table tr:hover { background:#f6faff; }
    
    .patient-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .patient-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4e54c8, #0b64e7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }
    
    .patient-details h4 {
      font-weight: 600;
      margin-bottom: 3px;
    }
    
    .patient-details p {
      font-size: 13px;
      color: #555;
    }
    
    .appointment-date, .appointment-time {
      font-weight: 500;
    }

    /* Status styles */
    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-booked { 
      background: rgba(255, 193, 7, 0.15);
      color: #ffc107;
    }
    
    .status-completed { 
      background: rgba(40, 167, 69, 0.15);
      color: #28a745;
    }
    
    .status-cancelled { 
      background: rgba(220, 53, 69, 0.15);
      color: #dc3545;
    }

    /* Checkbox Styles */
    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .checkbox-label {
      font-size: 14px;
      color: #555;
    }
    
    .styled-checkbox {
      appearance: none;
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 5px;
      border: 2px solid #ddd;
      outline: none;
      cursor: pointer;
      position: relative;
      transition: all 0.3s;
    }
    
    .styled-checkbox:checked {
      background: #0b64e7;
      border-color: #0b64e7;
    }
    
    .styled-checkbox:checked::after {
      content: "✓";
      position: absolute;
      color: white;
      font-size: 14px;
      font-weight: bold;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 8px;
    }
    
    .btn {
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-sm {
      padding: 5px 10px;
      font-size: 13px;
    }
    
    .btn-primary {
      background: #0b64e7;
      color: white;
    }
    
    .btn-primary:hover {
      background: #074eb4;
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid #ddd;
      color: #555;
    }
    
    .btn-outline:hover {
      background: #e9ecef;
    }

    /* No Appointments Message */
    .no-appointments {
      text-align: center;
      padding: 40px;
      color: #555;
    }
    
    .no-appointments i {
      font-size: 50px;
      margin-bottom: 15px;
      color: #ddd;
    }

    /* Quick Actions Section */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .action-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }
    
    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .action-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(11, 100, 231, 0.1);
      color: #0b64e7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin: 0 auto 15px;
    }
    
    .action-card h3 {
      font-size: 16px;
      margin-bottom: 5px;
      color: #333;
    }
    
    .action-card p {
      color: #666;
      font-size: 13px;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(-10px); }
      to { opacity:1; transform:translateY(0); }
    }
    
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(20px); }
      to { opacity:1; transform:translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .appointments-table {
        display: block;
        overflow-x: auto;
      }
    }
    
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 15px;
        padding: 15px 20px;
      }
      
      nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
      }
      
      nav a {
        margin-left: 0;
      }
      
      .welcome-card {
        flex-direction: column;
        text-align: center;
      }
      
      .stats-cards, .quick-actions {
        grid-template-columns: 1fr;
      }
      
      .section-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .filter-options {
        flex-wrap: wrap;
      }
    }
    
    @media (max-width: 576px) {
      .container {
        padding: 20px 15px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header>
    <div class="logo">
      <i class="fas fa-stethoscope"></i>
      <h1>Telemedicine Nabha - Doctor Dashboard</h1>
    </div>
    <nav>
      <a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Home</a>
      <a href="{{ url_for('doctors_page') }}"><i class="fas fa-user-md"></i> Doctors</a>
      <a href="{{ url_for('logout') }}" style="font-weight:bold; color:#ffdfdf;"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="container">
    <!-- Welcome -->
    <div class="welcome-card">
      <div class="doctor-avatar">
        <i class="fas fa-user-md"></i>
      </div>
      <div class="welcome-text">
        <h2>Welcome, Dr. {{ doctor.name }}</h2>
        <p>Manage your appointments and provide care to patients across Nabha's villages.</p>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards">
      <div class="stat-card">
        <div class="stat-icon appointments">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-info">
          <h3>{{ appointments|length if appointments else 0 }}</h3>
          <p>Total Appointments</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ completed_count if completed_count else 0 }}</h3>
          <p>Completed</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon pending">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-info">
          <h3>{{ pending_count if pending_count else 0 }}</h3>
          <p>Pending</p>
        </div>
      </div>
    </div>

    <!-- Appointments -->
    <div class="appointments-section">
      <div class="section-header">
        <h3><i class="fas fa-list-alt"></i> Your Appointments</h3>
        <div class="filter-options">
          <button class="filter-btn active">All</button>
          <button class="filter-btn">Today</button>
          <button class="filter-btn">Upcoming</button>
        </div>
      </div>

      {% if appointments %}
      <div class="appointments-table-container">
        <table class="appointments-table">
          <thead>
            <tr>
              <th>Patient</th>
              <th>Date</th>
              <th>Time</th>
              <th>Status</th>
              <th>Actions</th>
              <th>Mark Complete</th>
            </tr>
          </thead>
          <tbody>
            {% for appt in appointments %}
            <tr>
              <td>
                <div class="patient-info">
                  <div class="patient-avatar">{{ appt.patient_name[0] }}{{ appt.patient_name.split(' ')[1][0] if appt.patient_name.split(' ')|length > 1 else '' }}</div>
                  <div class="patient-details">
                    <h4>{{ appt.patient_name }}</h4>
                    <p>Teleconsultation</p>
                  </div>
                </div>
              </td>
              <td class="appointment-date">{{ appt.date }}</td>
              <td class="appointment-time">{{ appt.time }}</td>
              <td>
                <span class="status status-{{ appt.status|lower }}">{{ appt.status }}</span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-primary btn-sm"><i class="fas fa-eye"></i> View</button>
                  <button class="btn btn-outline btn-sm"><i class="fas fa-edit"></i> Reschedule</button>
                </div>
              </td>
              <td>
                <div class="checkbox-container">
                  <input type="checkbox" class="styled-checkbox" id="appt-{{ appt.id }}" 
                    {% if appt.status|lower == 'completed' %}checked{% endif %}
                    {% if appt.status|lower == 'cancelled' %}disabled{% endif %}>
                  <label class="checkbox-label" for="appt-{{ appt.id }}">Completed</label>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="no-appointments">
        <i class="fas fa-calendar-times"></i>
        <p>No appointments scheduled yet.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <script>
    // Function to handle checkbox changes
    document.querySelectorAll('.styled-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const row = this.closest('tr');
        const statusCell = row.querySelector('.status');
        const appointmentId = this.id.split('-')[1];
        
        if (this.checked) {
          statusCell.textContent = 'Completed';
          statusCell.className = 'status status-completed';
          
          // Send update to server
          fetch('/update_appointment_status', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              appointment_id: appointmentId,
              status: 'completed'
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              console.log('Appointment status updated to completed');
            } else {
              console.error('Failed to update appointment status');
              this.checked = false;
              statusCell.textContent = 'Booked';
              statusCell.className = 'status status-booked';
            }
          })
          .catch(error => {
            console.error('Error:', error);
            this.checked = false;
            statusCell.textContent = 'Booked';
            statusCell.className = 'status status-booked';
          });
        } else {
          statusCell.textContent = 'Booked';
          statusCell.className = 'status status-booked';
          
          // Send update to server
          fetch('/update_appointment_status', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              appointment_id: appointmentId,
              status: 'booked'
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              console.log('Appointment status updated to booked');
            } else {
              console.error('Failed to update appointment status');
              this.checked = true;
              statusCell.textContent = 'Completed';
              statusCell.className = 'status status-completed';
            }
          })
          .catch(error => {
            console.error('Error:', error);
            this.checked = true;
            statusCell.textContent = 'Completed';
            statusCell.className = 'status status-completed';
          });
        }
      });
    });

    // Filter buttons functionality
    document.querySelectorAll('.filter-btn').forEach(button => {
      button.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        
        // In a real application, this would filter the appointments
        console.log('Filter changed to: ' + this.textContent);
      });
    });
  </script>
</body>
</html>